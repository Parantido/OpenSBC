/*!
 * @package   yii2-dynagrid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015
 * @version   1.4.2
 *
 * JQuery Plugin for yii2-dynagrid.
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){var t=function(t,i){return null===t||void 0===t||t==[]||""===t||i&&""===e.trim(t)},i=function(e){var t=e.attr("name");return t.toLowerCase().replace(/-/g,"_")+"_activeform"},n=function(e){var n=e.closest("form"),s=n.data("yiiActiveForm"),o=i(e);t(o)||t(s)||(window[o]=s)},s=function(t,i){this.$element=e(t),this.submitMessage=i.submitMessage,this.deleteMessage=i.deleteMessage,this.deleteConfirmation=i.deleteConfirmation,this.modalId=i.modalId,this.init(),this.listen()};s.prototype={constructor:s,init:function(){var s=this,o=e("#"+s.modalId),a=i(s.$element),r=s.$element.closest("form");s.$form=r,t(window[a])&&n(s.$element),s.$visibleEl=r.find(".sortable-visible"),s.$hiddenEl=r.find(".sortable-hidden"),s.$visibleKeys=r.find('input[name="visibleKeys"]'),s.$btnSubmit=o.find(".dynagrid-submit"),s.$btnDelete=o.find(".dynagrid-delete"),s.$btnReset=o.find(".dynagrid-reset"),s.$formContainer=r.parent(),s.setColumnKeys(),s.visibleContent=s.$visibleEl.html(),s.hiddenContent=s.$hiddenEl.html(),s.visibleSortableOptions=window[s.$visibleEl.attr("data-krajee-sortable")],s.hiddenSortableOptions=window[s.$hiddenEl.attr("data-krajee-sortable")]},listen:function(){{var e=this,t=e.$form,i=e.$formContainer;e.$form.data("yiiActiveForm")}e.$btnSubmit.off("click").on("click",function(){e.setColumnKeys(),e.$visibleKeys.val(e.visibleKeys),t.hide(),i.prepend(e.submitMessage),setTimeout(function(){t.submit()},1e3)}),e.$btnDelete.off("click").on("click",function(){if(confirm(e.deleteConfirmation)){var n=t.find('input[name="deleteFlag"]');n.val(1),t.hide(),i.prepend(e.deleteMessage),setTimeout(function(){t.submit()},1e3)}}),e.$btnReset.off("click").on("click",function(){e.$visibleEl.sortable("destroy").html(e.visibleContent),e.$hiddenEl.sortable("destroy").html(e.hiddenContent),e.setColumnKeys(),i.find(".dynagrid-submit-message").remove(),e.$visibleEl.sortable(e.visibleSortableOptions),e.$hiddenEl.sortable(e.hiddenSortableOptions),t.trigger("reset.yiiActiveForm"),setTimeout(function(){t.find("select").trigger("change")},100)}),t.off("afterValidate").on("afterValidate",function(e,n){for(var s in n)if(n[s].length>0)return t.show(),void i.find(".dynagrid-submit-message").remove()})},reset:function(){var n=this,s=n.$element.closest("form"),o=i(n.$element),a=window[o];t(a)||(s.yiiActiveForm("destroy"),s.yiiActiveForm(a.attributes,a.settings)),s.find("select[data-krajee-select2]").each(function(){var t=e(this);e.when(t.select2(window[t.attr("data-krajee-select2")])).done(function(){void 0!==t.select2&&initSelect2Loading(t.attr("id"),".select2-container--krajee")})}),s.find("[data-krajee-sortable]").each(function(){var t=e(this);void 0!==t.sortable&&t.sortable("destroy"),t.sortable(window[t.attr("data-krajee-sortable")])})},setColumnKeys:function(){var t=this;t.visibleKeys=t.$visibleEl.find("li").map(function(t,i){return e(i).attr("id")}).get().join(",")}},e.fn.dynagrid=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var n=e(this),o=n.data("dynagrid"),a="object"==typeof t&&t;o||n.data("dynagrid",o=new s(this,e.extend({},e.fn.dynagrid.defaults,a,e(this).data()))),"string"==typeof t&&o[t].apply(o,i)})},e.fn.dynagrid.defaults={submitMessage:"",deleteMessage:"",deleteConfirmation:"Are you sure you want to delete all your grid personalization settings?",modalId:""}}(jQuery);